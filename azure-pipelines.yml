trigger:
- main   # Change if your branch name is different

pool:
  vmImage: 'windows-latest'

variables:
  buildConfiguration: 'Release'

steps:

# Install .NET 8 SDK
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '8.0.x'

# Restore NuGet packages
- script: dotnet restore
  displayName: 'Restore packages'

# Build project
- script: dotnet build --configuration $(buildConfiguration) --no-restore
  displayName: 'Build project'

# Run Reqnroll tests
- script: |
    echo Running tests and forcing TRX location...
    dotnet test --configuration $(buildConfiguration) --logger "trx;LogFileName=TestResults.trx" --results-directory "$(Agent.TempDirectory)"
  displayName: 'Run Tests'


# Publish test results in Azure DevOps
- task: PublishTestResults@2
  inputs:
    testResultsFormat: 'VSTest'
    testResultsFiles: '$(Agent.TempDirectory)/*.trx'
    searchFolder: '$(Agent.TempDirectory)'
    mergeTestResults: true
    testRunTitle: 'Reqnroll Test Results'

# Upload reports (Extent + Screenshots)- task: PublishBuildArtifacts@1
- task: PublishBuildArtifacts@1
  displayName: 'Upload Automation Reports'
  condition: succeededOrFailed()
  inputs:
    PathtoPublish: '$(Build.SourcesDirectory)/ReqnrollProject/bin/Release/net8.0/Reports'
    ArtifactName: 'AutomationReports'
    publishLocation: 'Container'
